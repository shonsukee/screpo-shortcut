{% extends "layout.html" %}

{% block content %}
<div class="container">
    <h1 class="title">ã‚¹ã‚¯ãƒ¬ãƒå…¥åŠ›</h1>
    <div class="wrap">
        <button id="toggle_button">ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±å…¥åŠ›</button>
        <form action="/students" method="post" class="login">
            <div class="login-row">
                <label for="user_id" class="login-text">ãƒ¦ãƒ¼ã‚¶ãƒ¼ID</label>
                <input type="text" inputmode="numeric" id="user_id" name="user_id" value="{{ user_id }}" required>
            </div>
            <div class="login-row">
                <label for="password" class="login-text">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                <input type="password" inputmode="numeric" id="password" name="password">
            </div>
            <button type="submit" id="fetch_student_info">ç”Ÿå¾’æƒ…å ±å–å¾—</button>
        </form>
    </div>

    {% if error %}
        <div class="no_student_wrap">
            <p class="no_student" style="color: #9B003F;">{{ error | safe }}</p>
        </div>
    {% else %}
        <div class="no_student_wrap">
            <p class="no_student" style="color:#1f2c5c;">æˆæ¥­ã¯ã‚ã‚Šã¾ã›ã‚“ğŸ’¤</p>
        </div>
    {% endif %}
</div>

<script>
    // æ—¥ä»˜ãŒå¤‰ã‚ã‚‹ã¨ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’åˆæœŸåŒ–
    window.addEventListener("load", function() {
        const today = new Date().toLocaleDateString();
        const lastAccessDate = localStorage.getItem("last_access_date");

        if (!lastAccessDate || lastAccessDate !== today) {
            localStorage.clear();
            localStorage.setItem("last_access_date", today);
        }
    });

    // ãƒœã‚¿ãƒ³ã®ä¸€æ™‚ç„¡åŠ¹åŒ–
    document.querySelector(".login").addEventListener("submit", function() {
        const button = document.getElementById("fetch_student_info");
        button.setAttribute("disabled", true);
        button.setAttribute('aria-disabled', true);
        button.textContent = "å–å¾—ä¸­...";
    });

    // è¬›å¸«ç”¨ãƒ­ã‚°ã‚¤ãƒ³IDã®ä¿å­˜
    document.getElementById("fetch_student_info").addEventListener("click", function() {
        const user_id = document.getElementById("user_id").value;
        localStorage.setItem("user_id", user_id);
    });

    // è¬›å¸«ç”¨ãƒ­ã‚°ã‚¤ãƒ³IDã®æ ¼ç´
    window.addEventListener("load", function() {
        const user_id = document.getElementById("user_id");
        const storedUserId = localStorage.getItem("user_id");
        if (storedUserId) {
            user_id.value = storedUserId;
        }
    });

    // è¬›å¸«ç”¨ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ãƒœã‚¿ãƒ³ã®è¡¨ç¤º
    document.getElementById("toggle_button").addEventListener("click", function() {
        const loginParams = document.querySelector(".login");
        const button = document.getElementById("toggle_button");

        if (loginParams.style.display == "none" || loginParams.style.display == "") {
            loginParams.style.display = "block";
            button.textContent = "ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±éè¡¨ç¤º";
        } else {
            loginParams.style.display = "none";
            button.textContent = "ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±å…¥åŠ›";
        }
    });
</script>
{% endblock %}